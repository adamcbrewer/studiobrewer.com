// Author:
// Adam Brewer - @adamcbrewer
// brewerlogic.com
var Portfolio=function(){var e={init:function(e){this._setup(e);this._events();this.hideInitial();this.renderGrid(!1);this.renderFilters(!1);window.location.search.indexOf("?")!=-1?this.parseQuery():this.renderIntro();return this},renderIntro:function(){var e=ich.ichIntro(this.portfolio),t=this;this.introCont.html(e);this.introCont.imagesLoaded({done:function(e){t.ready(function(){this.switchView(!1,t.introCont)})},progress:function(e,t,n,r){}})},findProject:function(e){var t=0,n=this.portfolio.projects;for(var r=0;r<this.numProjects;r++);for(t;t<this.numProjects;t++)if(n[t].slug===e){var i=n[t],s=n[t-1]||!1,o=n[t+1]||!1;return{current:i,prev:s,next:o}}return!1},projectPaging:function(e){e.prev=projects[i-1]||!1;e.next=projects[i+1]||!1},openProject:function(e){var t=this.findProject(e),n=this,r=!1;e.length===0&&(e="404");this.appendQuery("project",e);this.detailCont.fadeOut(100,function(){n.busy();var e=ich.ichProjectDetail({project:t.current,prev:t.prev,next:t.next});n.detailCont.html(e).imagesLoaded({done:function(e){n.ready(function(){this.switchView(this.current,n.detailCont)})}})})},renderGrid:function(e){e=e===!1?!1:!0;var t=ich.ichGrid(this.portfolio),n=this;this.projectsCont.html(t);this.projectsCont.find(".grid-project").hide();this.projectsCont.imagesLoaded({done:function(t){n.ready(function(){e&&this.switchView(!1,n.viewCont)})},progress:function(e,t,n,r){$(this).closest(".grid-project").fadeIn(600)}})},busy:function(e){e=e||!1;var t=this;this.logo.addClass("animate");this.loader.fadeIn(200,function(){typeof e=="function"&&e.apply(t)})},ready:function(e){e=e||!1;var t=this;this.loader.fadeOut(200,function(){t.logo.removeClass("animate");typeof e=="function"&&e.apply(t)})},switchView:function(e,t,n){e=e||this.current||!1;t=t||!1;n=n||!1;var r=this;this.discoSlide(0,10);e?e.fadeOut(100,function(){t.fadeIn(100,function(){r.current=t;n&&typeof n=="function"&&n.call(null,{})})}):t.fadeIn(200,function(){r.current=t;n&&typeof n=="function"&&n.call(null,{})})},discoSlide:function(e,t){e=e||0;t=t||200;$("html, body").animate({scrollTop:e},t);return this},get:function(e,t){e=e||"";t=t||!1;var n=this;if(e==="profile"){var r=this.profileCont.html().length?!0:!1;r?this.busy(function(){n.ready(function(){n.switchView(this.current,this.profileCont);t&&t.length&&this.discoSlide(1e4,400)})}):this.busy(function(){var e=ich.ichProfile(n.portfolio.profile);n.ready(function(){n.profileCont.html(e);this.switchView(n.current,this.profileCont);t&&t.length&&this.discoSlide(1e4,400)})})}else e==="projects"&&this.busy(function(){n.ready(function(){n.switchView(!1,this.viewCont)})});this.appendQuery("view",e);t&&t.length?this.navLinks.removeClass("current").filter('[data-get="'+e+'"][data-hash]').addClass("current"):this.navLinks.removeClass("current").filter('[data-get="'+e+'"]').not("[data-hash]").addClass("current")},filterProjects:function(e){var t=this;if(typeof e=="string"&&e!="false"){var n=this.projectsCont.find('[data-tags*="'+e+'"]'),r=this.projectsCont.find(".grid-project").not(n);this.tagsCont.find("[data-filter]").removeClass("current").filter('[data-filter="'+e+'"]').addClass("current");n.removeClass("hidden");r.addClass("hidden");this.appendQuery("filter",e);this.selectedProject=null;this.highlightProject(!1)}else if(e=="false"){t.tagsCont.find("[data-filter]").removeClass("current");t.projectsCont.find("[data-tags]").removeClass("hidden");this.appendQuery("view","projects");this.selectedProject=null;this.highlightProject(!1)}return this},renderFilters:function(){var e=ich.ichFilter(this.portfolio);this.tagsCont.html(e);this.togglers.show()},applyToggle:function(e){e=e||!1;var t=this;if(e==="tags"){var n=this.togglers.find('[data-toggle="'+e+'"]');n.toggleClass("current");this.tagsCont.toggleClass("hide");this.filterProjects(n.hasClass("current"))}else{this.togglers.find("[data-toggle]").not('[data-toggle="tags"]').removeClass("current").filter('[data-toggle="'+e+'"]').addClass("current");if(e==="grid"){t.projectsCont.removeClass("list");t.appendQuery("view","projects")}else{t.projectsCont.addClass("list");t.appendQuery("view",e)}t.ready(function(){})}return this},hideInitial:function(){this.profileCont.hide();this.detailCont.hide();this.viewCont.hide();this.introCont.hide()},appendQuery:function(e,t){if(Modernizr.history){if(arguments[0]===!1||arguments[0]===!0){var n=S.basePath;n.substr(-1,1)!=="/"&&(n+="/");window.history.pushState(null,"",n);return}var r=window.location.search,i=r.replace("?","").queryToObj(),s,o=!1;r+=r.indexOf("?")==-1?"?":"";for(s in i){var u=i.hasOwnProperty(s);if(u&&i[s]===t){o=!0;break}}if(!o){r="?"+e+"="+t;var a={};a[e]=t;window.history.pushState(a,r,r)}}},parseQuery:function(){var e=window.location.search.replace("?",""),t=e.queryToObj();t.project&&this.openProject(t.project);t.filter&&this.applyToggle("tags").filterProjects(t.filter).get("projects");t.view&&(t.view==="grid"||t.view==="list"?this.applyToggle(t.view).get("projects"):t.view==="profile"?this.get(t.view):t.view==="projects"&&this.get(t.view))},hiddenProjects:function(){var e=this.projectsCont.find(".grid-project"),t=e.filter(".hidden");return t},visibleProjects:function(){var e=this.projectsCont.find(".grid-project"),t=e.filter(":not(.hidden)");return t},highlightProject:function(e){e!==!1&&(e=e||null);this.projectsCont.find(".grid-project").removeClass("current");if(e!==!1){var t=this.visibleProjects(),n=$(t[this.selectedProject]),r;n.addClass("current");this.highlightedProject=n;r=this.highlightedProject.offset();this.discoSlide(r.top,200)}else{this.selectedProject=null;this.highlightedProject=!1}return this},_events:function(){var e=this,t="createTouch"in document?"touchstart":"click";$(document).on("click",".grid-project",function(t){var n=t.target.getAttribute("data-filter");n&&n.length?e.filterProjects(n):e.openProject(this.getAttribute("data-slug"))});this.detailCont.on(t,'[rel="next"], [rel="prev"]',function(t){t.preventDefault();e.openProject(this.getAttribute("data-slug"))});$(window).on(t,"[data-get]",function(t){t.preventDefault();var n=this.getAttribute("data-get"),r=this.getAttribute("data-hash");e.get(n,r)});this.togglers.on(t,"[data-toggle]",function(t){t.preventDefault();var n=this.getAttribute("data-toggle");e.applyToggle(n)});this.tagsCont.on(t,"[data-filter]",function(t){t.preventDefault();var n=this.getAttribute("data-filter");n===e.tagsCont.find(".current").attr("data-filter")?e.filterProjects(!1):e.filterProjects(n)});document.addEventListener("keydown",function(t){var n=t.keyCode||!1,r=e.current;if(n){var i=!1,s=r.attr("data-content");if(n===27){s==="view"&&(e.tagsCont.hasClass("hide")?e.projectsCont.hasClass("list")&&e.applyToggle("grid"):e.applyToggle("tags"));s==="detail"&&e.get("projects");e.highlightedProject&&e.highlightProject(!1).discoSlide(0,400)}if(n===9)if(s==="view")e.projectsCont.hasClass("list")?e.applyToggle("grid"):e.applyToggle("list");else{s==="intro"&&e.get("projects");s==="profile"&&e.get("projects")}if(n===13){t.preventDefault();e.highlightedProject&&e.openProject(e.highlightedProject.attr("data-slug"))}if(n===37&&s==="detail"){i=r.find('[rel="prev"]').attr("data-slug");i&&e.openProject(i)}if(n===38&&s==="view"){t.preventDefault();if(e.selectedProject>0){t.preventDefault();e.selectedProject--}e.highlightProject(e.selectedProject)}if(n===39&&s==="detail"){i=r.find('[rel="next"]').attr("data-slug");i&&e.openProject(i)}if(n===40&&s==="view"){t.preventDefault();typeof e.selectedProject!="number"?e.selectedProject=0:e.selectedProject<e.numProjects-1&&e.selectedProject++;e.highlightProject(e.selectedProject)}}});Modernizr.history&&(window.onpopstate=function(t){window.location.search.indexOf("?")!=-1?e.parseQuery():e.switchView(!1,e.viewCont)})},_setup:function(e){e=e||{};this.portfolio=e.portfolio;this.viewCont=e.viewCont;this.detailCont=e.detailCont;this.projectsCont=e.projectsCont;this.profileCont=e.profileCont;this.introCont=e.introCont;this.tagsCont=e.tagsCont;this.togglers=e.togglers;this.navLinks=e.navLinks;this.loader=e.loader;this.logo=e.logo;this.eventType=e.eventType;this.tagsCont.toggleClass("hide");this.numProjects=this.portfolio.projects.length;this.selectedProject=null;this.highlightedProject=null;this.selectedFilter=!1}};return e};